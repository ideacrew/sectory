defmodule Sectory.Records.VulnerabilityAnalysisScope do
  use Ecto.Schema
  import Ecto.Changeset

  schema "vulnerability_analysis_scopes" do
    belongs_to :vulnerability_analysis, Sectory.Records.VulnerabilityAnalysis
    field :vulnerability_identifier, :string
    belongs_to :deliverable, Sectory.Records.Deliverable
    belongs_to :deliverable_version, Sectory.Records.DeliverableVersion
    timestamps()
  end

  def new(params \\ %{}) do
    changeset(%__MODULE__{}, params)
  end

  def changeset(vulnerability_analysis_scope, params \\ %{}) do
    vulnerability_analysis_scope
      |> cast(params, [:vulnerability_analysis_id, :deliverable_id, :deliverable_version_id, :vulnerability_identifier])
      |> validate_required([:vulnerability_analysis_id, :vulnerability_identifier])
      |> validate_length(:vulnerability_identifier, max: 256)
  end
end
