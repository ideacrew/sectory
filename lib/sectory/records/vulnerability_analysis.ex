defmodule Sectory.Records.VulnerabilityAnalysis do
  use Ecto.Schema
  import Ecto.Changeset

  @moduledoc """
  An analysis of a particular vulnerability.
  """

  schema "vulnerability_analyses" do
    field :state, :string
    field :justification, :string
    field :response, :string
    field :adjusted_severity, :string
    field :detail, :string
    timestamps()
  end

  def new(params \\ %{}) do
    changeset(%__MODULE__{}, params)
  end

  def changeset(vulnerability_analysis, params \\ %{}) do
    vulnerability_analysis
      |> cast(params, [
        :state,
        :justification,
        :response,
        :detail,
        :adjusted_severity
      ])
      |> validate_required([:state, :adjusted_severity])
      |> validate_length(:state, max: 128)
      |> validate_length(:justification, max: 128)
      |> validate_length(:response, max: 128)
      |> validate_length(:adjusted_severity, max: 128)
  end
end
