defmodule Sectory.Repo.Migrations.CreateVulnerabilityAnalyses do
  use Ecto.Migration

  def change do
    create table("vulnerability_analyses") do
      add :state, :string, size: 128, null: false
      add :justification, :string, size: 128, null: true
      add :response, :string, size: 128, null: true
      add :detail, :text, null: false
      timestamps()
    end

    create table("vulnerability_analysis_scopes") do
      add :vulnerability_analysis_id, references(:vulnerability_analyses), null: false
      add :vulnerability_identifier, :string, size: 256, null: false
      add :deliverable_id, references(:deliverables), null: true
      add :deliverable_version_id, references(:deliverable_versions), null: true
      timestamps()
    end

    create index("vulnerability_analysis_scopes", [:vulnerability_analysis_id])
    create index("vulnerability_analysis_scopes", [:vulnerability_identifier])
    create index("vulnerability_analysis_scopes", [:deliverable_id])
    create index("vulnerability_analysis_scopes", [:deliverable_version_id])
  end
end
